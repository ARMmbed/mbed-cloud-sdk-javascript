{"version":3,"sources":["_tests/subscribe.ts"],"names":[],"mappings":"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,EAAE,GAAG,EAAE,KAAK,EAAE,cAAc,EAAE;QAClC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,cAAc,EAAE;QAClC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,cAAc,EAAE;QAClC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,cAAc,EAAE;QAClC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,cAAc,EAAE;QAClC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,cAAc,EAAE;QAClC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,cAAc,EAAE;QAClC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,gBAAgB,EAAE;QACpC,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7B,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7B,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7B,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7B,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7B,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7B,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7B,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7B,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,SAAS,EAAE;KAChC,CAAC;IAEF,OAAO,CAAC,OAAO,CAAC,UAAA,IAAI,IAAI,OAAA,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,EAAtB,CAAsB,CAAC,CAAC;AACpD,CAAC;AAzCD,gCAyCC","file":"subscribe.js","sourcesContent":["/*\n* Mbed Cloud JavaScript SDK\n* Copyright Arm Limited 2017\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n* http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\nconst { suite, test } = intern.getInterface(\"tdd\");\nconst { assert } = intern.getPlugin(\"chai\");\n\nimport { Subscribe } from \"../connect/subscribe/subscribe\";\nimport { DeviceEvent } from \"../connect/types\";\nimport { Resource } from \"../connect/models/resource\";\n\nsuite(\"testSubscribe\", () => {\n\n    test(\"allEvents\", () => {\n        const subscribe = new Subscribe();\n        const items: Array<DeviceEvent<Resource>> = [];\n        const observer = subscribe.deviceState();\n        observer.addCallback(res => items.push(res));\n        mockNotify(subscribe);\n        assert.lengthOf(items, 36);\n        mockNotify(subscribe);\n        assert.lengthOf(items, 72);\n    });\n\n    test(\"oneDeviceId\", () => {\n        const subscribe = new Subscribe();\n        const items: Array<DeviceEvent<Resource>> = [];\n        const observer = subscribe.deviceState({ id: \"1\" });\n        observer.addCallback(res => items.push(res));\n        mockNotify(subscribe);\n        assert.lengthOf(items, 8);\n        mockNotify(subscribe);\n        assert.lengthOf(items, 16);\n    });\n\n    test(\"multipleDeviceId\", () => {\n        const subscribe = new Subscribe();\n        const items: Array<DeviceEvent<Resource>> = [];\n        const observer = subscribe.deviceState({ id: [ \"1\", \"2\" ] });\n        observer.addCallback(res => items.push(res));\n        mockNotify(subscribe);\n        assert.lengthOf(items, 16);\n        mockNotify(subscribe);\n        assert.lengthOf(items, 32);\n    });\n\n    test(\"oneState\", () => {\n        const subscribe = new Subscribe();\n        const items: Array<DeviceEvent<Resource>> = [];\n        const observer = subscribe.deviceState({ event: \"registration\" });\n        observer.addCallback(res => items.push(res));\n        mockNotify(subscribe);\n        assert.lengthOf(items, 9);\n        mockNotify(subscribe);\n        assert.lengthOf(items, 18);\n    });\n\n    test(\"multipleStates\", () => {\n        const subscribe = new Subscribe();\n        const items: Array<DeviceEvent<Resource>> = [];\n        const observer = subscribe.deviceState({ event: [ \"registration\", \"deregistration\" ] });\n        observer.addCallback(res => items.push(res));\n        mockNotify(subscribe);\n        assert.lengthOf(items, 18);\n        mockNotify(subscribe);\n        assert.lengthOf(items, 36);\n    });\n\n    test(\"specific\", () => {\n        const subscribe = new Subscribe();\n        const items: Array<DeviceEvent<Resource>> = [];\n        const observer = subscribe.deviceState({ id: \"1\", event: \"registration\" });\n        observer.addCallback(res => items.push(res));\n        mockNotify(subscribe);\n        assert.lengthOf(items, 2);\n        mockNotify(subscribe);\n        assert.lengthOf(items, 4);\n    });\n\n    test(\"multipleSpecific\", () => {\n        const subscribe = new Subscribe();\n        const items: Array<DeviceEvent<Resource>> = [];\n        const observer = subscribe.deviceState({ id: [ \"1\", \"3\" ], event: [ \"registration\", \"deregistration\" ] });\n        observer.addCallback(res => items.push(res));\n        mockNotify(subscribe);\n        assert.lengthOf(items, 8);\n        mockNotify(subscribe);\n        assert.lengthOf(items, 16);\n    });\n});\n\nexport function mockNotify(subscribe: Subscribe): void {\n    const regList: Array<DeviceEvent<Resource>> = [\n        { id: \"1\", event: \"registration\" },\n        { id: \"1\", event: \"registration\" },\n        { id: \"2\", event: \"registration\" },\n        { id: \"2\", event: \"registration\" },\n        { id: \"3\", event: \"registration\" },\n        { id: \"3\", event: \"registration\" },\n        { id: \"4\", event: \"registration\" },\n        { id: \"4\", event: \"registration\" },\n        { id: \"5\", event: \"registration\" },\n        { id: \"1\", event: \"reregistration\" },\n        { id: \"1\", event: \"reregistration\" },\n        { id: \"2\", event: \"reregistration\" },\n        { id: \"2\", event: \"reregistration\" },\n        { id: \"3\", event: \"reregistration\" },\n        { id: \"3\", event: \"reregistration\" },\n        { id: \"4\", event: \"reregistration\" },\n        { id: \"4\", event: \"reregistration\" },\n        { id: \"5\", event: \"reregistration\" },\n        { id: \"1\", event: \"deregistration\" },\n        { id: \"1\", event: \"deregistration\" },\n        { id: \"2\", event: \"deregistration\" },\n        { id: \"2\", event: \"deregistration\" },\n        { id: \"3\", event: \"deregistration\" },\n        { id: \"3\", event: \"deregistration\" },\n        { id: \"4\", event: \"deregistration\" },\n        { id: \"4\", event: \"deregistration\" },\n        { id: \"5\", event: \"deregistration\" },\n        { id: \"1\", event: \"expired\" },\n        { id: \"1\", event: \"expired\" },\n        { id: \"2\", event: \"expired\" },\n        { id: \"2\", event: \"expired\" },\n        { id: \"3\", event: \"expired\" },\n        { id: \"3\", event: \"expired\" },\n        { id: \"4\", event: \"expired\" },\n        { id: \"4\", event: \"expired\" },\n        { id: \"5\", event: \"expired\" },\n    ];\n\n    regList.forEach(item => subscribe.notify(item));\n}\n"],"sourceRoot":"../../src"}